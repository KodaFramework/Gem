<html>
<head>
	<script src="../../plugins/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../plugins/json2.js" type="text/javascript" charset="utf-8"></script>
	<script src="../KodaEditor.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" href="../../../css/editor.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head>
<body>
	<div id="editor">
		<form id="form" name="form" method="post">
			<h1>Default JSON Editor</h1>
			<p>Default editor for JSON documents</p>

			<input type="hidden" id="ref" name="ref" />

			<label>Name
			<span class="small">Name</span>
			</label>
			<input type="text" name="name" id="name" />

			<label>JSON Data
			<span class="small">JSON Data</span>
			</label>
			<textarea name="data" id="data"></textarea>

			<button type="submit">Save</button>
			<div class="spacer"></div>
		</form>
		<div id="status"></div>
	</div>
<script>
	
	(function() {
		var kodaEditor = KodaEditor();
		var isNew = kodaEditor.isNew;
		
		if(!isNew) {
			kodaEditor.get('/'+kodaEditor.itemUrl.toLowerCase(), function(result){
				$('#name').val(result.title);
				$('#ref').val(result._koda_ref);
				$('#data').val(JSON.stringify(result.content, null, 2));
			});
		}
			
		$('form').submit(function(e) {
			var data = $('#data').val();
			e.preventDefault();
			
			if(isNew) {
				var ref = $('#name').val().replace(/ /g,"-").toLowerCase();
				var data = '{"_koda_ref":"'+ref+'", "title":"'+$('#name').val()+'", "content":'+$('#data').val()+'}';
				
				kodaEditor.post('/'+kodaEditor.itemUrl.toLowerCase(), data, function(sdata) {

					if(sdata == "OK") {					
						$('#status').text("item saved");									
					} else {				
						$('#status').text("item could not be saved");				
					}
				});
			} else {
				var ref = $('#ref').val();
				var data = '{"_koda_ref":"'+ref+'", "title":"'+$('#name').val()+'", "content":'+$('#data').val()+'}';
				
				kodaEditor.put('/'+kodaEditor.itemUrl.toLowerCase(), data, function(sdata) {

					if(sdata == "OK") {					
						$('#status').text("item saved");									
					} else {				
						$('#status').text("item could not be saved");				
					}
				});
			}
			
		
		});
			
		
	})();
</script>
</body>
<html>
